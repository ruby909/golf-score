<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>115å¹´æ˜¥å­£æœƒå…§è³½-åˆ—å°å„ªåŒ–ç‰ˆ</title>
    <style>
        :root { --primary: #1b4332; --accent: #d32f2f; --bg: #f8fafc; --invalid: #ffe4e6; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* å°è¦½åŠŸèƒ½å€ */
        .sticky-header { position: sticky; top: 0; z-index: 1000; background: white; border-bottom: 2px solid #cbd5e1; padding: 8px 0; }
        .nav-bar { display: flex; overflow-x: auto; gap: 6px; padding: 5px 12px; }
        .nav-bar::-webkit-scrollbar { display: none; }
        .nav-btn { flex: 0 0 auto; width: 36px; height: 36px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 6px; font-weight: bold; }
        .action-bar { display: flex; justify-content: center; gap: 10px; padding: 8px 0; }
        .btn { padding: 8px 16px; font-size: 14px; border-radius: 6px; border: none; color: white; font-weight: bold; cursor: pointer; }
        .btn-rank { background: var(--accent); }
        .btn-print { background: #2563eb; }

        /* è¡¨æ ¼é¡¯ç¤º */
        .content { padding: 8px; }
        table { width: 100%; border-collapse: collapse; background: white; table-layout: fixed; }
        th { background: var(--primary); color: white; padding: 12px 2px; font-size: 14px; }
        td { border-bottom: 1px solid #f1f5f9; padding: 10px 0; text-align: center; }
        .col-info { width: 90px; text-align: left; padding-left: 6px; }
        .name-text { font-size: 15px; font-weight: bold; display: block; }
        .sub-info { font-size: 10px; color: #64748b; display: block; }
        
        input[type="number"] { width: 44px; height: 36px; border: 1px solid #cbd5e1; border-radius: 4px; text-align: center; font-size: 18px; font-weight: bold; }
        input.invalid { background-color: var(--invalid); border-color: var(--accent); color: var(--accent); }
        .total-cell { font-weight: bold; color: var(--accent); font-size: 19px; }
        .error-text { font-size: 12px; color: #94a3b8; }
        .print-val { display: none; }

        /* --- åˆ—å°æ ¸å¿ƒè¨­å®š --- */
        @media print {
            .no-print, .sticky-header { display: none !important; }
            .print-val { display: inline-block !important; font-size: 16px; font-weight: bold; }
            input { display: none !important; }
            table { width: 100%; border: 1px solid #000; table-layout: auto; }
            th, td { border: 1px solid #000; padding: 6px; color: black !important; }
            
            /* é‡é»ï¼šåªè¦é€™è¡Œè¢«æ¨™è¨˜ç‚º invalid-row (ç©ºç™½æˆ–ä¸ç¬¦)ï¼Œåˆ—å°æ™‚å°±å®Œå…¨æ¶ˆå¤± */
            tr.invalid-row { display: none !important; }
        }
    </style>
</head>
<body>

<div class="sticky-header no-print">
    <div class="nav-bar">
        <script>for(let i=1; i<=12; i++) document.write(`<button class="nav-btn" onclick="goToGroup(${i})">${i}</button>`);</script>
    </div>
    <div class="action-bar">
        <button class="btn btn-rank" onclick="calculateRank()">ğŸ“Š è¨ˆç®—æ’å</button>
        <button class="btn btn-print" onclick="handlePrint()">ğŸ–¨ï¸ åˆ—å°å®Œè³½è€…</button>
        <button style="background:#94a3b8; width: 36px; height:36px; border-radius:6px;" class="btn" onclick="clearData()">âœ•</button>
    </div>
</div>

<div class="content">
    <table id="mainTable">
        <thead>
            <tr>
                <th style="width:30px">#</th>
                <th class="col-info">é¸æ‰‹</th>
                <th>çƒ1</th>
                <th>çƒ2</th>
                <th>ç¸½åˆ†</th>
                <th>HIO</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    const players = [
        {name:"é™³æµ©è¯", bday:"39.12.21", group:"1-1"}, {name:"é»ƒéº—å¿", bday:"33.11.28", group:"1-2"}, {name:"æé¦™è˜­", bday:"39.12.30", group:"1-3"}, {name:"æ¶‚é‡‘è‘‰", bday:"36.08.17", group:"1-4"}, {name:"é»ƒä¸€æ–‡", bday:"44.12.18", group:"1-5"}, {name:"è‘›ä¿®ç«‹", bday:"41.07.26", group:"1-6"}, {name:"ç‹åœ‹æ˜", bday:"49.11.29", group:"1-7"}, {name:"æº«ä¸‰éƒ", bday:"30.09.02", group:"1-8"},
        {name:"å¤æ·‘å®š", bday:"50.02.04", group:"2-1"}, {name:"å¾å¯Œç¾", bday:"34.07.08", group:"2-2"}, {name:"æ—è‚²å ‚", bday:"51.01.17", group:"2-3"}, {name:"ææ—¥ä¼¸", bday:"43.06.05", group:"2-4"}, {name:"å‘¨æ­£çª“", bday:"46.12.06", group:"2-5"}, {name:"å³éŠ˜å±•", bday:"50.04.09", group:"2-6"}, {name:"é™³é‘¾é³³", bday:"36.02.02", group:"2-7"}, {name:"é«˜ç§€è˜­", bday:"37.04.08", group:"2-8"},
        {name:"å¤æ·‘ç", bday:"40.01.26", group:"3-1"}, {name:"å¤æ–‡å¿ ", bday:"47.07.26", group:"3-2"}, {name:"è³´å»ºäº¨", bday:"41.12.18", group:"3-3"}, {name:"æŸ¯é‡é›„", bday:"30.03.20", group:"3-4"}, {name:"é‚±æ¸…æº", bday:"48.10.10", group:"3-5"}, {name:"è”¡éº—ç¥", bday:"52.09.15", group:"3-6"}, {name:"å³å¿ æ”¿", bday:"60.03.23", group:"3-7"}, {name:"è”¡æŒ¯é›„", bday:"41.04.27", group:"3-8"},
        {name:"æ´ªè‚‡æ¼¢", bday:"47.05.01", group:"4-1"}, {name:"å»–ä¹ç´…", bday:"36.10.07", group:"4-2"}, {name:"é„­æœ¨é›„", bday:"46.01.11", group:"4-3"}, {name:"æ—é †èª ", bday:"44.11.15", group:"4-4"}, {name:"ç‹æŸæ¬½", bday:"58.11.16", group:"4-5"}, {name:"é‚±æ†¶è", bday:"57.02.13", group:"4-6"}, {name:"ç‹é™³æˆ", bday:"49.09.17", group:"4-7"}, {name:"é»ƒä¸–è³¢", bday:"41.11.13", group:"4-8"},
        {name:"ç°¡ç‘èŒ‚", bday:"50.12.02", group:"5-1"}, {name:"ç‰›å·½åº·", bday:"38.02.21", group:"5-2"}, {name:"æ—ç§€ç¾", bday:"49.11.10", group:"5-3"}, {name:"ç‹ç±³å‰", bday:"31.03.01", group:"5-4"}, {name:"é»ƒæ­£å¿ ", bday:"49.12.08", group:"5-5"}, {name:"æ—ç§€å¨Ÿ", bday:"56.09.04", group:"5-6"}, {name:"æ±Ÿæ˜èŠ³", bday:"43.11.16", group:"5-7"}, {name:"ç°¡è°æ˜", bday:"42.09.04", group:"5-8"},
        {name:"è·¯æµ·å°", bday:"40.05.20", group:"6-1"}, {name:"æ—é‡‘æœ", bday:"36.08.27", group:"6-2"}, {name:"èŠç™»ç« ", bday:"39.08.28", group:"6-3"}, {name:"ç‹æéº—å¿", bday:"39.06.30", group:"6-4"}, {name:"å¼µå”å¾·", bday:"39.08.12", group:"6-5"}, {name:"è©¹ç‡•æ²»", bday:"39.12.10", group:"6-6"}, {name:"é™³ å’Œ", bday:"26.02.22", group:"6-7"}, {name:"ç‹æ˜å±±", bday:"35.04.20", group:"6-8"},
        {name:"é—•ç¢§æ¢…", bday:"48.09.21", group:"7-1"}, {name:"æ±Ÿéº—ç ", bday:"35.07.25", group:"7-2"}, {name:"é™³ç¢§ç ", bday:"47.12.21", group:"7-3"}, {name:"è¨±å¿—ç”·", bday:"45.12.09", group:"7-4"}, {name:"é™³æ°‘ç”Ÿ", bday:"42.10.06", group:"7-5"}, {name:"æ±Ÿè¾°é›„", bday:"34.01.16", group:"7-6"}, {name:"é‚±é‡‘ç”Ÿ", bday:"47.04.28", group:"7-7"}, {name:"é™³ çµ²", bday:"31.03.21", group:"7-8"},
        {name:"éƒ­å»ºèˆˆ", bday:"38.03.18", group:"8-1"}, {name:"éƒ­å¬Œ", bday:"44.10.10", group:"8-2"}, {name:"å‚…å…ƒé‡‘", bday:"34.11.01", group:"8-3"}, {name:"åˆ© æ¢…", bday:"30.10.06", group:"8-4"}, {name:"æ—éŒ¦äº®", bday:"47.05.20", group:"8-5"}, {name:"è‘£åœ‹ä¿Š", bday:"39.12.31", group:"8-6"}, {name:"å³æ²›æŸ”", bday:"41.05.01", group:"8-7"}, {name:"æç´ æƒ ", bday:"46.11.05", group:"8-8"},
        {name:"æ¸¸æŒ¯é´»", bday:"40.10.13", group:"9-1"}, {name:"å‚…èŠ³ç´³", bday:"28.09.26", group:"9-2"}, {name:"å‚…åŠ‰èŠé¦™", bday:"36.07.06", group:"9-3"}, {name:"é»ƒå…¨ç”°", bday:"39.09.10", group:"9-4"}, {name:"é»ƒæ¸…æ±Ÿ", bday:"49.08.23", group:"9-5"}, {name:"å»–ç¾èŠ¬", bday:"51.12.22", group:"9-6"}, {name:"ç‹æ¦®åŠ©", bday:"31.12.03", group:"9-7"}, {name:"æ¥Šæ–‡ç¥¥", bday:"46.05.23", group:"9-8"},
        {name:"å¼µæƒ çœŸ", bday:"45.07.24", group:"10-1"}, {name:"é«˜æ–‡é´»", bday:"40.01.15", group:"10-2"}, {name:"å¼µæœˆç´", bday:"45.12.12", group:"10-3"}, {name:"å‘‚çŠé›²", bday:"43.05.15", group:"10-4"}, {name:"çŸ³æ··ç”Ÿ", bday:"34.04.01", group:"10-5"}, {name:"é»ƒå­¸ç”²", bday:"47.04.01", group:"10-6"}, {name:"å‘‚éŠ˜å®¸", bday:"43.08.01", group:"10-7"}, {name:"å¼µæ˜ä»", bday:"40.02.02", group:"10-8"},
        {name:"é»ƒèŒ‚æ¨Ÿ", bday:"40.09.26", group:"11-1"}, {name:"é™³é‡‘é‘¾", bday:"43.03.10", group:"11-2"}, {name:"é»ƒ æ˜¥", bday:"61.02.13", group:"11-3"}, {name:"é¾å¯¶å¦¹", bday:"50.10.19", group:"11-4"}, {name:"é—•é‡‘å¡—", bday:"51.07.27", group:"11-5"}, {name:"å³ä¾†æ—º", bday:"33.11.06", group:"11-6"}, {name:"æ›¾å¬Œç", bday:"36.05.24", group:"11-7"}, {name:"å³ç››å¤", bday:"36.12.01", group:"11-8"},
        {name:"å»–é€²å¿ ", bday:"38.06.30", group:"12-1"}, {name:"å»– è€", bday:"44.11.08", group:"12-2"}, {name:"å­«æ­¦å¾©", bday:"36.01.10", group:"12-3"}, {name:"å³æŸæ¯…", bday:"45.01.05", group:"12-4"}, {name:"é™³é¾æ–‡", bday:"39.08.14", group:"12-5"}, {name:"å§œå½©èŠ±", bday:"49.10.19", group:"12-6"}, {name:"ææ­£å–œ", bday:"30.09.05", group:"12-7"}, {name:"é€£å¯¬ä»", bday:"32.06.03", group:"12-8"}
    ];

    const STORE_KEY = 'golf_final_validated_v3';

    function init() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        const saved = JSON.parse(localStorage.getItem(STORE_KEY) || '{}');
        players.forEach((p) => {
            const key = p.name + p.group;
            const d = saved[key] || {s1:'', s2:'', hio:''};
            const row = document.createElement('tr');
            row.className = `group-row-${p.group.split('-')[0]}`;
            row.setAttribute('data-bday', p.bday);
            row.setAttribute('data-key', key);
            row.innerHTML = `
                <td class="rank-cell">-</td>
                <td class="col-info"><span class="name-text">${p.name}</span><span class="sub-info">${p.group} | ${p.bday}</span></td>
                <td><input type="number" class="s1" value="${d.s1}" oninput="valRow(this);nx(this)"><span class="print-val">${d.s1}</span></td>
                <td><input type="number" class="s2" value="${d.s2}" oninput="valRow(this)"><span class="print-val">${d.s2}</span></td>
                <td><span class="total-cell">-</span></td>
                <td><input type="number" class="hio" value="${d.hio}" oninput="valRow(this)"><span class="print-val">${d.hio}</span></td>
            `;
            tbody.appendChild(row);
            valRow(row.querySelector('.s1'), false);
        });
    }

    function valRow(el, save = true) {
        const r = el.closest('tr');
        const v1 = r.querySelector('.s1'), v2 = r.querySelector('.s2'), vh = r.querySelector('.hio');
        const s1 = parseInt(v1.value), s2 = parseInt(v2.value);
        const tc = r.querySelector('.total-cell');

        v1.classList.toggle('invalid', v1.value !== '' && s1 < 20);
        v2.classList.toggle('invalid', v2.value !== '' && s2 < 20);

        let total = (s1 || 0) + (s2 || 0);
        // åˆ¤å®šæœ‰æ•ˆæ€§ï¼šå…©å ´éƒ½å¡«äº† + æ¯å ´ >= 20 + ç¸½åˆ† >= 50
        let isComplete = (v1.value !== '' && v2.value !== '' && s1 >= 20 && s2 >= 20 && total >= 50);

        if (v1.value === '' && v2.value === '') {
            tc.innerText = "-"; 
            r.classList.add('invalid-row'); // ç©ºç™½åˆ—ï¼Œä¸å°
        } else if (!isComplete) {
            tc.innerText = (v1.value !== '' && v2.value !== '') ? "ä¸ç¬¦" : total;
            tc.classList.add('error-text'); 
            r.classList.add('invalid-row'); // ä¸ç¬¦åˆè¦å‰‡åˆ—ï¼Œä¸å°
        } else {
            tc.innerText = total; 
            tc.classList.remove('error-text'); 
            r.classList.remove('invalid-row'); // åˆæ ¼ï¼Œè¦å°
        }

        r.querySelectorAll('.print-val')[0].innerText = v1.value;
        r.querySelectorAll('.print-val')[1].innerText = v2.value;
        r.querySelectorAll('.print-val')[2].innerText = vh.value;

        if(save) {
            const s = JSON.parse(localStorage.getItem(STORE_KEY) || '{}');
            s[r.getAttribute('data-key')] = { s1: v1.value, s2: v2.value, hio: vh.value };
            localStorage.setItem(STORE_KEY, JSON.stringify(s));
        }
    }

    function goToGroup(num) {
        const f = document.querySelector(`.group-row-${num}`);
        if(f) window.scrollTo({ top: f.getBoundingClientRect().top + window.pageYOffset - 140, behavior: 'smooth' });
    }

    function nx(el) { if(el.value.length >= 2) el.closest('tr').querySelector('.s2').focus(); }

    function calculateRank() {
        const rs = Array.from(document.querySelectorAll('#tableBody tr'));
        const dt = rs.map(r => {
            const s1 = parseInt(r.querySelector('.s1').value), s2 = parseInt(r.querySelector('.s2').value);
            const t = (s1 || 0) + (s2 || 0);
            const ok = (r.querySelector('.s1').value !== '' && r.querySelector('.s2').value !== '' && s1 >= 20 && s2 >= 20 && t >= 50);
            return { r, t: ok ? t : 99999, h: parseInt(r.querySelector('.hio').value)||0, b: r.getAttribute('data-bday'), ok };
        });
        dt.sort((a,b) => a.t - b.t || b.h - a.h || a.b.localeCompare(b.b));
        const b = document.getElementById('tableBody'); b.innerHTML = '';
        dt.forEach((it, i) => {
            it.r.querySelector('.rank-cell').innerText = it.ok ? (i+1) : "-";
            b.appendChild(it.r); 
        });
        window.scrollTo(0,0);
    }

    function handlePrint() { 
        calculateRank(); 
        // ç¢ºä¿è¨ˆç®—æ’åå¾Œï¼Œç•«é¢ä¸Šä¸åˆè¦çš„äººå·²ç¶“éš±è—äº†
        setTimeout(() => { window.print(); }, 300); 
    }
    
    function clearData() { if(confirm("ç¢ºå®šæ¸…ç©ºåˆ†æ•¸ï¼Ÿ")) { localStorage.removeItem(STORE_KEY); location.reload(); } }
    init();
</script>
</body>
</html>